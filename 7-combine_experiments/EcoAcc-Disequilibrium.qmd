---
title: "EcoAcc: Disequilibrium"
author: "Kara Dobson"
date: "`r format(Sys.time(), '%d %B, %Y')`"
format: 
  html:
    code-fold: true
    code-line-numbers: true
    code-tools:
      source: false
    toc: true
embed-resources: true
dpi: 300
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r, echo = F, message = F, warning = F}
# Load packages
library(tidyverse)
library(ggpubr)
library(deeptime)
library(patchwork)
library(plotly)
library(maps)
library(mapdata)
library(gridExtra)
library(viridis)

# Set path to turbo to get plot data
path_data = "/Volumes/seas-zhukai/proj-ecoacc-experiment/data_for_plots/"
setwd(path_data)
# Load in data
map_dis <- readRDS(" map_disequilibrium.rds")

cti_yearly <- readRDS(" cti_yearly.rds")
cpi_yearly <- readRDS(" cpi_yearly.rds")

cti <- readRDS(" cti.rds")
sens <- readRDS(" sens.rds")
cti_sens <- readRDS(" cti_sens.rds")
biocon_cti <- readRDS(" biocon_cti.rds")
temperature_and_cti <- readRDS(" temperature_and_cti.rds")
biomass_and_cti <- readRDS(" biomass_and_cti.rds")
biomass_vs_cti <- readRDS(" biomass_vs_cti.rds")
biomass_vs_cti_treatments <- readRDS(" biomass_vs_cti_treatments.rds")
biomass_vs_dis <- readRDS(" biomass_vs_disequilib.rds")
biomass_vs_dis_treatments <- readRDS(" biomass_vs_disequilib_treatments.rds")
biomass_vs_mat <- readRDS(" biomass_vs_mat.rds")
biomass_vs_mat_treatments <- readRDS(" biomass_vs_mat_treatments.rds")
treatment_arrows <- readRDS(" treatment_arrows.rds")

diseq_model <- readRDS(" diseq_model.rds")
comb_diseq_model <- readRDS(" comb_diseq_model.rds")
diseq_model_knz <- readRDS(" diseq_model_knz.rds")
diseq_model_hys <- readRDS(" diseq_model_hys.rds")
diseq_model_sgs <- readRDS(" diseq_model_sgs.rds")
diseq_model_chy <- readRDS(" diseq_model_chy.rds")

ok_terraclim <- readRDS(" ok_disequilib_terraclim.rds")
ok_sensors <- readRDS(" ok_disequilib_sensors.rds")

```

### Map of experiment locations

```{r, message = F, warning = F, fig.width = 11, fig.height = 6}
map_dis
```

### CTI and CPI over time

```{r, message = F, warning = F, fig.width = 11, fig.height = 6}
cti_yearly
cpi_yearly
```

### Model comparisons: Drought experiments (one site: KNZ)

| Model                                                | AIC          | R\^2      |
|------------------------------------------------------|--------------|-----------|
| biomass \~ CPI + (1\|block)                          | 4287.667     | 0.002     |
| biomass \~ treatment + CPI + (1\|block)              | 4212.094     | 0.194     |
| biomass \~ treatment + (1\|block)                    | 4212.371     | 0.192     |
| biomass \~ disequilib + (1\|block)                   | 4194.223     | 0.265     |
| biomass \~ disequilib + CPI + (1\|block)             | 4193.344     | 0.268     |
| biomass \~ AP + (1\|block)                           | 4193.248     | 0.267     |
| biomass \~ disequilib + treatment + (1\|block)       | 4175.389     | 0.288     |
| biomass \~ disequilib + treatment + AP + (1\|block)  | 4173.885     | 0.292     |
| biomass \~ disequilib + treatment + CPI + (1\|block) | 4173.885     | 0.292     |
| **biomass \~ treatment + AP + (1\|block)**           | **4173.475** | **0.292** |

```{r, message = F, warning = F, fig.width = 10, fig.height = 8}
wrap_plots(diseq_model_knz,diseq_model_hys,
           diseq_model_sgs,diseq_model_chy,
          ncol=2,nrow=2) +
  plot_layout(guides = "collect",axis_titles = "collect")
```
